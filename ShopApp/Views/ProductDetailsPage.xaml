<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:ShopApp.ViewModels"
             x:Class="ShopApp.Views.ProductDetailsPage"
             Title="{Binding Title}">

    <ContentPage.Resources>
        <Shadow x:Key="SharedShadow" Brush="Black" Offset="0,-5" Radius="10" Opacity="0.1"/>
    </ContentPage.Resources>

    <Grid RowDefinitions="*, Auto" BackgroundColor="White">
        <!-- Main Scrollable Content -->
        <ScrollView Grid.Row="0">
            <VerticalStackLayout Spacing="0">
                <!-- Hero Image Area -->
                <Grid HeightRequest="350" BackgroundColor="#F5F5F5">
                    <Image Source="{Binding Product.ImageUrl}" Aspect="AspectFit" Margin="40"/>
                    <Border StrokeShape="RoundRectangle 20" BackgroundColor="White" Padding="10" HorizontalOptions="Start" VerticalOptions="Start" Margin="20" StrokeThickness="0" Shadow="{StaticResource SharedShadow}">
                        <Label Text="{Binding Product.CategoryName}" TextColor="{StaticResource Primary}" FontAttributes="Bold" FontSize="12"/>
                    </Border>
                </Grid>

                <!-- Product Content Radius Overlap -->
                <Border Margin="0,-30,0,0" StrokeShape="RoundRectangle 30,30,0,0" StrokeThickness="0" BackgroundColor="White" Padding="25,35,25,20">
                    <VerticalStackLayout Spacing="15">
                        <Grid ColumnDefinitions="*, Auto">
                            <Label Grid.Column="0" Text="{Binding Product.Name}" FontSize="24" FontAttributes="Bold" TextColor="Black" LineHeight="1.2"/>
                            <Label Grid.Column="1" Text="{Binding Product.Price, StringFormat='{0:C}'}" FontSize="24" FontAttributes="Bold" TextColor="{StaticResource Primary}" VerticalOptions="Start"/>
                        </Grid>

                        <Label Text="Description" FontSize="16" FontAttributes="Bold" TextColor="Black" Margin="0,10,0,0"/>
                        <Label Text="{Binding Product.Description}" FontSize="14" TextColor="{StaticResource Gray500}" LineHeight="1.5"/>
                    </VerticalStackLayout>
                </Border>
            </VerticalStackLayout>
        </ScrollView>

        <!-- Sticky Footer Action -->
        <Border Grid.Row="1" StrokeShape="RoundRectangle 20,20,0,0" StrokeThickness="0" BackgroundColor="White" Padding="20,15,20,30" Shadow="{StaticResource SharedShadow}">
            <Grid ColumnDefinitions="Auto, *">
                <!-- Quantity Selector -->
                <Border Grid.Column="0" StrokeShape="RoundRectangle 15" BackgroundColor="{StaticResource Secondary}" StrokeThickness="0" Padding="15,10" Margin="0,0,20,0" HeightRequest="50" WidthRequest="120">
                     <HorizontalStackLayout Spacing="15" HorizontalOptions="Center" VerticalOptions="Center">
                        <Label Text="-" TextColor="{StaticResource Primary}" FontAttributes="Bold" FontSize="20">
                            <Label.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding DecreaseQuantityCommand}"/>
                            </Label.GestureRecognizers>
                        </Label>
                        <Label Text="{Binding Quantity}" TextColor="{StaticResource Primary}" FontAttributes="Bold" FontSize="18"/>
                        <Label Text="+" TextColor="{StaticResource Primary}" FontAttributes="Bold" FontSize="20">
                             <Label.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding IncreaseQuantityCommand}"/>
                            </Label.GestureRecognizers>
                        </Label>
                    </HorizontalStackLayout>
                </Border>

                <!-- Add Button -->
                <Button Grid.Column="1" Text="Add to Cart" Command="{Binding AddToCartCommand}" CornerRadius="15" FontAttributes="Bold" FontSize="16" HeightRequest="50"/>
            </Grid>
        </Border>
        
        <ActivityIndicator Grid.RowSpan="2" IsRunning="{Binding IsBusy}" IsVisible="{Binding IsBusy}" Color="{StaticResource Primary}" VerticalOptions="Center" HorizontalOptions="Center"/>
    </Grid>
</ContentPage>
