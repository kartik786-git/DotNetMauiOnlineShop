<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:ShopApp.ViewModels"
             xmlns:models="clr-namespace:ShopApp.Models"
             x:Class="ShopApp.Views.CartPage"
             Title="{Binding Title}">

    <ContentPage.Resources>
        <Shadow x:Key="SharedShadow" Brush="Black" Offset="0,-5" Radius="10" Opacity="0.1"/>
    </ContentPage.Resources>

    <Grid RowDefinitions="*, Auto" BackgroundColor="#F5F5F5">
        <!-- Cart Items List -->
        <CollectionView Grid.Row="0" ItemsSource="{Binding CartItems}" Margin="0,10">
            <CollectionView.EmptyView>
                <VerticalStackLayout VerticalOptions="Center" HorizontalOptions="Center" Spacing="10">
                    <Label Text="&#x1F6D2;" FontSize="60" HorizontalOptions="Center" TextColor="{StaticResource Gray300}"/>
                    <Label Text="Your Cart is Empty" FontSize="20" FontAttributes="Bold" TextColor="{StaticResource Gray500}"/>
                </VerticalStackLayout>
            </CollectionView.EmptyView>
            <CollectionView.ItemTemplate>
                <DataTemplate x:DataType="models:CartItem">
                    <Border Margin="15,8" Padding="15" StrokeShape="RoundRectangle 15" BackgroundColor="White" StrokeThickness="0">
                        <Grid ColumnDefinitions="Auto, *, Auto" RowDefinitions="Auto, Auto">
                             <Image Grid.Column="0" Grid.RowSpan="2" Source="product_placeholder.png" Aspect="AspectFill" HeightRequest="60" WidthRequest="60" Margin="0,0,15,0">
                                <Image.Source>
                                    <FontImageSource FontFamily="OpenSansRegular" Glyph="&#x1F4E6;" Color="{StaticResource Gray300}" Size="40"/>
                                </Image.Source>
                             </Image>
                            
                            <!-- Product Info -->
                            <VerticalStackLayout Grid.Column="1" Grid.Row="0" Spacing="2">
                                <Label Text="{Binding ProductName}" FontAttributes="Bold" FontSize="16" TextColor="Black" LineBreakMode="TailTruncation"/>
                                <Label Text="{Binding ProductPrice, StringFormat='{0:C}'}" TextColor="{StaticResource Gray500}" FontSize="12"/>
                            </VerticalStackLayout>
                            
                            <!-- Total Price for Item -->
                            <Label Grid.Column="2" Grid.Row="0" Text="{Binding TotalPrice, StringFormat='{0:C}'}" FontAttributes="Bold" TextColor="{StaticResource Primary}" VerticalOptions="Start" HorizontalOptions="End"/>

                            <!-- Quantity Controls (If needed, for now just displaying Quantity) -->
                             <HorizontalStackLayout Grid.Column="1" Grid.Row="1" Spacing="5" Margin="0,10,0,0">
                                <Label Text="Qty:" TextColor="{StaticResource Gray400}" FontSize="12" VerticalOptions="Center"/>
                                <Label Text="{Binding Quantity}" FontAttributes="Bold" TextColor="Black" VerticalOptions="Center"/>
                            </HorizontalStackLayout>
                        </Grid>
                    </Border>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>
        
        <!-- Sticky Summary Footer -->
        <Border Grid.Row="1" StrokeShape="RoundRectangle 20,20,0,0" BackgroundColor="White" StrokeThickness="0" Padding="20,20,20,30" Shadow="{StaticResource SharedShadow}">
            <VerticalStackLayout Spacing="20">
                <!-- Summary Lines -->
                <Grid ColumnDefinitions="*, Auto">
                    <Label Grid.Column="0" Text="Subtotal" TextColor="{StaticResource Gray500}"/>
                    <Label Grid.Column="1" Text="{Binding TotalAmount, StringFormat='{0:C}'}" FontAttributes="Bold" TextColor="Black"/>
                </Grid>
                <Grid ColumnDefinitions="*, Auto">
                    <Label Grid.Column="0" Text="Tax (Estimated)" TextColor="{StaticResource Gray500}"/>
                    <Label Grid.Column="1" Text="$0.00" FontAttributes="Bold" TextColor="Black"/>
                </Grid>
                <BoxView HeightRequest="1" Color="{StaticResource Gray100}"/>
                
                <!-- Total -->
                <Grid ColumnDefinitions="*, Auto">
                    <Label Grid.Column="0" Text="Total" FontSize="20" FontAttributes="Bold" TextColor="Black"/>
                    <Label Grid.Column="1" Text="{Binding TotalAmount, StringFormat='{0:C}'}" FontSize="20" FontAttributes="Bold" TextColor="{StaticResource Primary}"/>
                </Grid>
                
                <!-- Checkout Button -->
                <Button Text="Checkout" Command="{Binding CheckoutCommand}" CornerRadius="15" HeightRequest="50" FontAttributes="Bold" FontSize="16" Margin="0,10,0,0"/>
            </VerticalStackLayout>
        </Border>
        
        <ActivityIndicator Grid.RowSpan="2" IsRunning="{Binding IsBusy}" IsVisible="{Binding IsBusy}" Color="{StaticResource Primary}" VerticalOptions="Center" HorizontalOptions="Center"/>
    </Grid>
</ContentPage>
